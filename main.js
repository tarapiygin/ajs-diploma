!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=49)}([function(e,t,r){var a=r(1),n=r(2);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,r){"use strict";var a,n=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},s=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),i=[];function o(e){for(var t=-1,r=0;r<i.length;r++)if(i[r].identifier===e){t=r;break}return t}function l(e,t){for(var r={},a=[],n=0;n<e.length;n++){var s=e[n],l=t.base?s[0]+t.base:s[0],c=r[l]||0,d="".concat(l," ").concat(c);r[l]=c+1;var h=o(d),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(i[h].references++,i[h].updater(u)):i.push({identifier:d,updater:g(u,t),references:1}),a.push(d)}return a}function c(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var n=r.nc;n&&(a.nonce=n)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var i=s(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var d,h=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,r,a){var n=r?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=h(t,n);else{var s=document.createTextNode(n),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(s,i[t]):e.appendChild(s)}}function m(e,t,r){var a=r.css,n=r.media,s=r.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),s&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var f=null,p=0;function g(e,t){var r,a,n;if(t.singleton){var s=p++;r=f||(f=c(t)),a=u.bind(null,r,s,!1),n=u.bind(null,r,s,!0)}else r=c(t),a=m.bind(null,r,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=n());var r=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<r.length;a++){var n=o(r[a]);i[n].references--}for(var s=l(e,t),c=0;c<r.length;c++){var d=o(r[c]);0===i[d].references&&(i[d].updater(),i.splice(d,1))}r=s}}}},function(e,t,r){var a=r(3),n=r(4),s=r(5),i=r(6),o=r(7),l=r(8),c=r(9),d=r(10),h=r(11),u=r(12),m=r(13),f=r(14),p=r(15),g=r(16),b=r(17),v=r(18),C=r(19),w=r(20),S=r(21),y=r(22),k=r(23),x=r(24),E=r(25),L=r(26),P=r(27),T=r(28),M=r(29),G=r(30),R=r(31),z=r(32),A=r(33),I=r(34),N=r(35),O=r(36),_=r(37),j=r(38),U=r(39),$=r(40),D=r(41),B=r(42),F=r(43),q=r(44),H=r(45),W=r(46),Y=r(47),J=r(48);t=a(!1);var Q=n(s),K=n(i),V=n(o),X=n(l),Z=n(c),ee=n(d),te=n(h),re=n(u),ae=n(m),ne=n(f),se=n(p),ie=n(g),oe=n(b),le=n(v),ce=n(C),de=n(w),he=n(S),ue=n(y),me=n(k),fe=n(x),pe=n(E),ge=n(L),be=n(P),ve=n(T),Ce=n(M),we=n(G),Se=n(R),ye=n(z),ke=n(A),xe=n(I),Ee=n(N),Le=n(O),Pe=n(_),Te=n(j),Me=n(U),Ge=n($),Re=n(D),ze=n(B),Ae=n(F),Ie=n(q),Ne=n(H),Oe=n(W),_e=n(Y),je=n(J);t.push([e.i,":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url("+Q+");\r\n  --map-tile-top-url: url("+K+");\r\n  --map-tile-top-right-url: url("+V+");\r\n  --map-tile-bottom-left-url: url("+X+");\r\n  --map-tile-bottom-url: url("+Z+");\r\n  --map-tile-bottom-right-url: url("+ee+");\r\n  --map-tile-left-url: url("+te+");\r\n  --map-tile-right-url: url("+re+");\r\n  --map-tile-center-url: url("+ae+");\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url("+ne+");\r\n  --map-tile-top-url: url("+se+");\r\n  --map-tile-top-right-url: url("+ie+");\r\n  --map-tile-bottom-left-url: url("+oe+");\r\n  --map-tile-bottom-url: url("+le+");\r\n  --map-tile-bottom-right-url: url("+ce+");\r\n  --map-tile-left-url: url("+de+");\r\n  --map-tile-right-url: url("+he+");\r\n  --map-tile-center-url: url("+ue+");\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url("+me+");\r\n  --map-tile-top-url: url("+fe+");\r\n  --map-tile-top-right-url: url("+pe+");\r\n  --map-tile-bottom-left-url: url("+ge+");\r\n  --map-tile-bottom-url: url("+be+");\r\n  --map-tile-bottom-right-url: url("+ve+");\r\n  --map-tile-left-url: url("+Ce+");\r\n  --map-tile-right-url: url("+we+");\r\n  --map-tile-center-url: url("+Se+");\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url("+ye+");\r\n  --map-tile-top-url: url("+ke+");\r\n  --map-tile-top-right-url: url("+xe+");\r\n  --map-tile-bottom-left-url: url("+Ee+");\r\n  --map-tile-bottom-url: url("+Le+");\r\n  --map-tile-bottom-right-url: url("+Pe+");\r\n  --map-tile-left-url: url("+Te+");\r\n  --map-tile-right-url: url("+Me+");\r\n  --map-tile-center-url: url("+Ge+");\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 99;\r\n}\r\n\r\n.character.generic {\r\n  background: url("+Re+");\r\n}\r\n\r\n.character.bowman {\r\n  background: url("+ze+");\r\n}\r\n\r\n.character.daemon {\r\n  background: url("+Ae+");\r\n}\r\n\r\n.character.magician {\r\n  background: url("+Ie+");\r\n}\r\n\r\n.character.swordsman {\r\n  background: url("+Ne+");\r\n}\r\n\r\n.character.undead {\r\n  background: url("+Oe+");\r\n}\r\n\r\n.character.vampire {\r\n  background: url("+_e+");\r\n}\r\n\r\n.character.zombie {\r\n  background: url("+je+");\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n.damage {\r\n  position: absolute;\r\n  width: var(--cell-size);\r\n  text-align: center;\r\n  z-index: 999;\r\n  color: #f00;\r\n  font-weight: bold;\r\n  animation: 500ms fade ease-out;\r\n}\r\n\r\n@keyframes fade {\r\n  from {\r\n    opacity: 0;\r\n    top: calc(var(--cell-size) * 0.5);\r\n    font-size: 1rem;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    top: -20px;\r\n    font-size: 1.5rem;\r\n  }\r\n}\r\n",""]),e.exports=t},function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",a=e[3];if(!a)return r;if(t&&"function"==typeof btoa){var n=(i=a,o=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(l," */")),s=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[r].concat(s).concat([n]).join("\n")}var i,o,l;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,a){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(a)for(var s=0;s<this.length;s++){var i=this[s][0];null!=i&&(n[i]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);a&&n[l[0]]||(r&&(l[2]?l[2]="".concat(r," and ").concat(l[2]):l[2]=r),t.push(l))}},t}},function(e,t,r){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},function(e,t,r){"use strict";r.r(t),t.default=r.p+"8b88329c33dba4faf42c7db49fe2a509.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"5f57874e43f12fffda467fc94116a049.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"caea269d39950b02486940475d78db2e.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"87372ea9616a8edba586f42970c5ef8b.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"31ad2c93c8f6cc84ef581b5de6849313.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"029ee51facbfc8a67f6adf424059eac4.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"648cb1dfd9a0b21ee19a3c4efb6d2841.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"668f7492bdec26da926f0391a6f188d5.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"cc657ec84e39b3415392f8088b704dbf.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"e4bb82fc350a47cd8d063dff5486ad16.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"58a43fae0d0f7deed4f58b2c8af5197f.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"ad09956ea38f698d2228241406d5c619.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"500b00a472496581b61c7b3f050228b9.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"e58a541e928b85192a72f859df20353d.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"8f709cffba9a0dba6e245a59906195bb.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"b48dcfbedbcfaeed76a58a6c2326f5b5.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"8a4eb60c50566e3a55b8a69b743a1495.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"489316d6dd3a667b0ec70f2967eda900.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"9c8b9b5dc8ca9f2a244602cc3b2d3096.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"54683de6e23a6fdcd697a3f79a7f8198.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"77ce902e513588459beb186a36611f25.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"97bbfe418bb50013cdc910294ab9cbe5.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"204557a8e0609ff17bd63f9a08505d5e.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"c98ac5b3fa5dc40db7bc7a44d9c994af.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"b952c69a4f0f29541770a83db6131b33.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"97ea9703ecf76d3be0c016d6e6e526c7.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"4c763a2addae8299d67b3c0617ad787e.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"80a5d0b947d35e167ad6bbf560e5b21a.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"5cc6716feb9da37e536e269ef7a4f1d6.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"47487165610b6ac8fc68098e8c02c50a.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"6980ce7b28ddccd6e1ea16b0b74a5d54.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"7acb75939d3b87572d01aa7952413f27.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"4f65b5f1f530843b6d86bb918f23df26.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"9c10a2462a67b8c84a8152d2e77e2c4a.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"de3b89c2edd67045607d081ad726c9d3.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"99f3aae6daf6ae69cf54dece74d39d89.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"0f5d3f5bfcaf4965cc0a170e6e479aa7.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"817d11bba3b3811d769ad627636349ad.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"c393200b8b85b1daa174111f386c212f.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"cc0123bb7e92111714143c3026f420fb.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"ff13fb8ff2d1ddb742a40d3a75187c0e.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"93609441a80af34c98563a7797ac8610.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"2f218dc52fb1968dab2f6df24998abb9.png"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"14ae8b1b0c430c4e0040e86919589975.png"},function(e,t,r){"use strict";r.r(t);r(0);class a{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",e=>this.onNewGameClick(e)),this.saveGameEl.addEventListener("click",e=>this.onSaveGameClick(e)),this.loadGameEl.addEventListener("click",e=>this.onLoadGameClick(e)),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const a=document.createElement("div");a.classList.add("cell","map-tile","map-tile-"+(t=e,r=this.boardSize,0===t?"top-left":t<r-1?"top":t===r-1?"top-right":t===r**2-1?"bottom-right":t>r**2-r?"bottom":t===r**2-r?"bottom-left":t%r==0?"left":t%r==r-1?"right":"center")),a.addEventListener("mouseenter",e=>this.onCellEnter(e)),a.addEventListener("mouseleave",e=>this.onCellLeave(e)),a.addEventListener("click",e=>this.onCellClick(e)),this.boardEl.appendChild(a)}var t,r;this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const r of e){const e=this.boardEl.children[r.position],a=document.createElement("div");a.classList.add("character",r.character.type);const n=document.createElement("div");n.classList.add("health-level");const s=document.createElement("div");s.classList.add("health-level-indicator","health-level-indicator-"+((t=r.character.health)<15?"critical":t<50?"normal":"high")),s.style.width=r.character.health+"%",n.appendChild(s),a.appendChild(n),e.appendChild(a)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach(e=>e.call(null,t))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach(e=>e.call(null,t))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach(e=>e.call(null,t))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach(e=>e.call(null))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach(e=>e.call(null))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach(e=>e.call(null))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e,t="yellow"){this.deselectCell(e),this.cells[e].classList.add("selected","selected-"+t)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter(e=>e.startsWith("selected")))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise(r=>{const a=this.cells[e],n=document.createElement("span");n.textContent=t,n.classList.add("damage"),a.appendChild(n),n.addEventListener("animationend",()=>{a.removeChild(n),r()})})}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}var n={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};class s{constructor(){this.members=new Set}add(e){this.members.add(e)}addAll(...e){for(const t of e)this.members.add(t)}toArray(){return[...this.members]}*[Symbol.iterator](){for(const e of this.members)yield e;return 0}get size(){return this.members.size}has(e){return this.members.has(e)}delete(e){return this.members.delete(e)}}var i=s;function*o(e,t){for(;;){const r=new(e[Math.round(Math.random()*(e.length-1))]);r.level=Math.round(Math.random()*(t-1))+1,yield r}}function l(e,t,r){const a=new i,n=o(e,t);for(;a.size<r;)a.add(n.next().value);return a}class c{constructor(e,t="generic"){if("Character"===new.target.name)throw new Error('Using "new Character()" not allowed');if(!e&&"generic"===t)throw new Error('Using "new Character()" not allowed');this._type=t,this._level=e,this.attack=0,this.defence=0,this.health=100,this.attackRadius=1,this.moveRadius=1}get type(){return this._type}get level(){return this._level}set level(e){if(this.level>e)throw new Error("Can't decrease level");for(;this.level<e;)this.levelUp()}damage(e){this.health-=e,this.health<0&&(this.health=0)}damageFromCharacter(e){const t=Math.max(e.attack-this.defence,.1*e.attack);return this.damage(t),t}levelUp(){if(0===this.health)throw new Error("Can't level up dead character");this._level+=1,this.attack=Math.max(this.attack,this.attack+(this.health/10-1.8)),this.defence=Math.max(this.defence,this.defence+(this.health/10-1.8)),this.health+=80,this.health>100&&(this.health=100)}}var d=class extends c{constructor(e=1){super(1,"bowman"),this.attack=25,this.defence=25,this.attackRadius=2,this.moveRadius=2,this.level=e}};var h=class extends c{constructor(e=1){super(1,"swordsman"),this.attack=40,this.defence=10,this.attackRadius=1,this.moveRadius=4,this.level=e}};var u=class extends c{constructor(e=1){super(1,"magician"),this.attack=10,this.defence=40,this.attackRadius=4,this.moveRadius=1,this.level=e}};var m=class extends c{constructor(e=1){super(1,"undead"),this.attack=25,this.defence=25,this.attackRadius=1,this.moveRadius=4,this.level=e}};var f=class extends c{constructor(e=1){super(1,"vampire"),this.attack=40,this.defence=10,this.attackRadius=2,this.moveRadius=2,this.level=e}};var p=class extends c{constructor(e=1){super(1,"daemon"),this.attack=10,this.defence=40,this.attackRadius=4,this.moveRadius=1,this.level=e}};class g{constructor(e,t){if(!(e instanceof c))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}class b{constructor(){this.board=new Map,this.level=1,this.userStep=!0,this.selectedCharacterIndex=-1,this.points=0}static from(e){const t=new b;if(e.level&&(t.level=e.level),e.userStep&&(t.userStep=e.userStep),e.selectedCharacterIndex&&(t.selectedCharacterIndex=e.selectedCharacterIndex),e.points&&(t.points=e.points),e.boardEntries)for(const r of e.boardEntries){let e;switch(r[1].character._type){case"bowman":e=d;break;case"swordsman":e=h;break;case"magician":e=u;break;case"undead":e=m;break;case"vampire":e=f;break;case"daemon":e=p;break;default:throw new Error("Wrong character type")}const a=new e;a.attack=r[1].character.attack,a.defence=r[1].character.defence,a.health=r[1].character.health,a.attackRadius=r[1].character.attackRadius,a.moveRadius=r[1].character.moveRadius,a._level=r[1].character._level,t.board.set(r[0],new g(a,r[1].position))}return t}}var v={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};class C extends class{constructor(e){if("Strategy"===new.target.name)throw new Error('Using "new Strategy()" not allowed');this.gameController=e}nextStep(){this.gameController.nextStep()}}{async nextStep(){const e=this.getBotsWhoCanAttack();if(e.length){const t=e[Math.round(Math.random()*(e.length-1))],r=this.gameController.getPositionedCharacter(t.bot).position;return this.gameController.onCellClick(r,!0),void await this.gameController.onCellClick(t.cells[Math.round(Math.random()*(t.cells.length-1))],!0)}const t=this.gameController.currentTeam.toArray(),r=t[Math.round(Math.random()*(t.length-1))],a=this.gameController.getPositionedCharacter(r).position;this.gameController.onCellClick(a,!0);const n=this.getAvailableCellsToMove(r);await this.gameController.onCellClick(n[Math.round(Math.random()*(n.length-1))],!0)}getBotsWhoCanAttack(){const e=[],t=this.gameController.currentTeam.toArray();for(const r of t){const t=this.getAvailableCellsToAttack(r);t.length>0&&e.push({bot:r,cells:t})}return e}getAvailableCellsToAttack(e){const t=[];for(let r=0;r<this.gameController.gamePlay.boardSize**2;r+=1)this.gameController.canAttack(e,r)&&t.push(r);return t}getAvailableCellsToMove(e){const t=[];for(let r=0;r<this.gameController.gamePlay.boardSize**2;r+=1)this.gameController.canMove(e,r)&&t.push(r);return t}}const w=new a;w.bindToDOM(document.querySelector("#game-container"));const S=new class{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}saveRecord(e){this.storage.setItem("record",e)}loadRecord(){return this.storage.getItem("record")}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}(localStorage);new class{constructor(e,t){this.gamePlay=e,this.stateService=t,this.stepEnabled=!0}init(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.newGame.bind(this)),this.gamePlay.addSaveGameListener(this.saveGame.bind(this)),this.gamePlay.addLoadGameListener(this.loadGame.bind(this)),this.loadGame()}newGame(){this.gameState=new b,this.nextLevel()}saveGame(){this.gameState.boardEntries=[...this.gameState.board.entries()],this.stateService.save(this.gameState),delete this.gameState.boardEntries,a.showMessage("Game saved")}loadGame(){let e;try{if(e=b.from(this.stateService.load()),!e.board.size)throw new Error("Load error")}catch(e){return this.gameState||this.newGame(),void a.showError("Nothing to load")}this.gameState=e,this.userTeam=new i,this.botTeam=new i;for(const e of this.gameState.board.values())switch(e.character.type){default:case"bowman":case"swordsman":case"magician":this.userTeam.add(e.character);break;case"daemon":case"undead":case"vampire":this.botTeam.add(e.character)}this.drawBoard(this.gameState.level),this.gamePlay.redrawPositions(this.gameState.board.values()),this.isCharacterSelected&&this.selectCharacter(this.selectedCharacterIndex)}onCellEnter(e){if(this.gameState.userStep){if(this.isCharacterExistsInCell(e)){const{character:t}=this.gameState.board.get(e);this.gamePlay.showCellTooltip(function(e){return`${String.fromCodePoint(127894)}${e.level}\n${String.fromCodePoint(9876)}${Number(e.attack.toFixed(1))}\n${String.fromCodePoint(128737)}${Number(e.defence.toFixed(1))}\n${String.fromCodePoint(10084)}${Number(e.health.toFixed(1))}`}(t),e)}(()=>{if(this.isCharacterSelected)return this.gameState.board.has(e)&&this.currentTeam.has(this.gameState.board.get(e).character)?void this.gamePlay.setCursor(v.pointer):this.canMove(this.selectedCharacter,e)?(this.gamePlay.setCursor(v.pointer),void this.gamePlay.selectCell(e,"green")):this.canAttack(this.selectedCharacter,e)?(this.gamePlay.setCursor(v.crosshair),void this.gamePlay.selectCell(e,"red")):void this.gamePlay.setCursor(v.notallowed);this.gameState.board.has(e)&&this.currentTeam.has(this.gameState.board.get(e).character)?this.gamePlay.setCursor(v.pointer):this.gamePlay.setCursor(v.notallowed)})()}}onCellLeave(e){this.gamePlay.hideCellTooltip(e),this.isCharacterSelected&&e!==this.gameState.selectedCharacterIndex&&this.gamePlay.deselectCell(e),this.gamePlay.setCursor(v.auto)}async onCellClick(e,t=!1){if(this.gameState.userStep||t){if(this.isCharacterSelected){if(this.canMove(this.selectedCharacter,e))return this.stepEnabled=!1,this.gameState.board.set(e,this.gameState.board.get(this.gameState.selectedCharacterIndex)),this.gameState.board.get(e).position=e,this.gameState.board.delete(this.gameState.selectedCharacterIndex),this.deselectAllCells(),this.gamePlay.redrawPositions(this.gameState.board.values()),void this.nextStep();if(this.canAttack(this.selectedCharacter,e)){this.stepEnabled=!1;const t=this.selectedCharacter,r=this.gameState.board.get(e).character,n=Number(r.damageFromCharacter(t).toFixed(1));return void this.gamePlay.showDamage(e,n).then(()=>{if(0===r.health&&(this.gameState.board.delete(e),this.anotherTeam.delete(r),this.deselectAllCells(),0===this.anotherTeam.size))return this.gameState.userStep?(this.gameState.points=Number(this.calcPoints().toFixed(1)),a.showMessage(`Level ${this.gameState.level} complete!\nYour score - ${this.gameState.points}!\nLast record - ${this.record}`),this.nextLevel(this.gameState.level+=1),void(this.stepEnabled=!0)):(a.showMessage("You lose!"),this.gamePlay.redrawPositions(this.gameState.board.values()),void(this.stepEnabled=!0));this.gamePlay.redrawPositions(this.gameState.board.values()),this.nextStep()})}}if(this.deselectAllCells(),this.isCharacterExistsInCell(e)){const{character:t}=this.gameState.board.get(e);if(this.currentTeam.has(t))return void this.selectCharacter(e);a.showError("You can't select this character")}}}nextStep(){if(this.stepEnabled=!0,this.deselectAllCells(),this.gameState.userStep=!this.gameState.userStep,!this.gameState.userStep){new C(this).nextStep()}}drawBoard(e){let t;switch(e){default:case 1:t=n.prairie;break;case 2:t=n.desert;break;case 3:t=n.arctic;break;case 4:t=n.mountain}this.gamePlay.drawUi(t)}nextLevel(e=1){const t=(e=!0)=>{const t=e?0:this.gamePlay.boardSize-2;return Math.round(Math.random()*(this.gamePlay.boardSize-1))*this.gamePlay.boardSize+t+Math.round(Math.random())},r=(e,r)=>{for(const a of e){let e=t(r);for(;this.gameState.board.has(e);)e=t(r);this.gameState.board.set(e,new g(a,e))}};switch(this.gameState.board=new Map,this.drawBoard(e),this.record<this.gameState.points&&(this.record=this.gameState.points),e){case 1:this.userTeam=l([d,h],1,2),this.botTeam=l([m,f,p],1,2);break;case 2:this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(o([d,h,u],1).next().value),this.botTeam=l([m,f,p],2,this.userTeam.size);break;case 3:this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(o([d,h,u],2).next().value),this.userTeam.add(o([d,h,u],2).next().value),this.botTeam=l([m,f,p],3,this.userTeam.size);break;case 4:this.gamePlay.drawUi(n.mountain),this.userTeam.toArray().forEach(e=>e.levelUp()),this.userTeam.add(o([d,h,u],3).next().value),this.userTeam.add(o([d,h,u],3).next().value),this.botTeam=l([m,f,p],4,this.userTeam.size);break;default:return void a.showMessage(`You win!\nYour score - ${Number(this.calcPoints().toFixed(1))}!\n${this.record===this.gameState.points?"NEW RECORD":"Last record"} - ${this.record}`)}this.deselectAllCells(),this.gameState.userStep=!0,r(this.userTeam,!0),r(this.botTeam,!1),this.gamePlay.redrawPositions(this.gameState.board.values())}calcPoints(){let e=0;for(const t of this.userTeam)e+=t.health;return e}deselectAllCells(){for(let e=0;e<this.gamePlay.boardSize**2;e+=1)this.gamePlay.deselectCell(e);this.gameState.selectedCharacterIndex=-1}isCharacterExistsInCell(e){return this.gameState.board.has(e)}get record(){return this.stateService.loadRecord()||0}set record(e){this.stateService.saveRecord(e)}get currentTeam(){return this.gameState.userStep?this.userTeam:this.botTeam}get anotherTeam(){return this.gameState.userStep?this.botTeam:this.userTeam}selectCharacter(e){return this.gamePlay.selectCell(e),this.gameState.selectedCharacterIndex=e,this.selectedCharacter}get isCharacterSelected(){return-1!==this.gameState.selectedCharacterIndex}get selectedCharacter(){return this.isCharacterSelected?this.gameState.board.get(this.gameState.selectedCharacterIndex).character:null}get selectedCharacterIndex(){return this.gameState.selectedCharacterIndex}getRow(e){return function(e,t){return Math.floor(e/t)}(e,this.gamePlay.boardSize)}getColumn(e){return function(e,t){return e%t}(e,this.gamePlay.boardSize)}getPositionedCharacter(e){for(const t of this.gameState.board.values())if(t.character===e)return t;return null}canMove(e,t){if(!this.stepEnabled)return!1;const r=this.getRow(t),a=this.getColumn(t),n="PositionedCharacter"!==e.constructor.name?this.getPositionedCharacter(e):e,s=this.getRow(n.position),i=this.getColumn(n.position);return(r===s||a===i||Math.abs(r-s)===Math.abs(a-i))&&Math.abs(r-s)<=n.character.moveRadius&&Math.abs(a-i)<=n.character.moveRadius&&!this.isCharacterExistsInCell(t)}canAttack(e,t){if(!this.stepEnabled)return!1;const r=this.getRow(t),a=this.getColumn(t),n="PositionedCharacter"!==e.constructor.name?this.getPositionedCharacter(e):e,s=this.getRow(n.position),i=this.getColumn(n.position);return Math.abs(r-s)<=n.character.attackRadius&&Math.abs(a-i)<=n.character.attackRadius&&this.gameState.board.has(t)&&this.anotherTeam.has(this.gameState.board.get(t).character)}}(w,S).init()}]);